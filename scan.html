<!DOCTYPE html>
<html lang="en">
<head>
  <link
  rel="apple-touch-icon"
  sizes="152x152"
  href="/apple-touch-icon.png?v=A0Rrm0rq0k"
  />
  <link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/favicon-32x32.png?v=A0Rrm0rq0k"
  />
  <link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/favicon-16x16.png?v=A0Rrm0rq0k"
  />
  <link rel="manifest" href="/manifest.json?v=A0Rrm0rq0k" />
  <link
  rel="mask-icon"
  href="/safari-pinned-tab.svg?v=A0Rrm0rq0k"
  color="#5bbad5"
  />
  <link rel="shortcut icon" href="/favicon.ico?v=A0Rrm0rq0k" />
  <meta name="theme-color" content="#aaaaaa" />
  <title>Scan Art Challenge</title>
  <meta
  property="og:image"
  content="https://s3.us-east-2.amazonaws.com/tomlum/scanartchallenge.png"
  />
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Can you complete your drawing while the scanner is moving?" />
  <script>
    (function (i, s, o, g, r, a, m) {
      i["GoogleAnalyticsObject"] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
      (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
    window,
    document,
    "script",
    "https://www.google-analytics.com/analytics.js",
    "ga"
    );

    ga("create", "UA-46705501-4", "auto");
    ga("send", "pageview");
  </script>
  <!-- Pixi -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.3.7/pixi.min.js" crossorigin="anonymous"></script>
  <!-- Custom CSS -->
  <link href="css/tomlum.css" rel="stylesheet" />
  <style>
    .button{
      border-radius: 2px;
      border: none;
    }
  </style>
</head>
<header></header>

<body style="overflow:hidden;">
  <div class="icons" style="height: 80px; margin: 0px; padding: 10px; padding: 10px; box-sizing: border-box;">
    <div>
      <!-- SOCIAL BUTTONS -->
      <a class="icon" href="/">
        <img
        src="https://s3.us-east-2.amazonaws.com/tomlum/me.png"
        width="70"
        />
      </a>
      <a
      class="icon"
      href="https://www.youtube.com/channel/UCim0JOU5CqZG3jKhU2c_yeg"
      target="_blank"
      >
      <img
      src="https://s3.us-east-2.amazonaws.com/tomlum/videos.png"
      alt="Youtube"
      width="70"
      />
    </a>
    <a class="icon" href="https://twitter.com/tomlumperson" target="_blank">
      <img
      src="https://s3.us-east-2.amazonaws.com/tomlum/bird.png"
      alt="Twitter"
      width="70"
      />
    </a>
    <a class="icon" href="mailto:TomLumPerson@gmail.com" target="_blank">
      <img
      src="https://s3.us-east-2.amazonaws.com/tomlum/mail.png"
      alt="Mail"
      width="70"
      />
    </a>
    <br />
  </div>
</div>
<div style="display: flex; height: calc(100vh - 130px);">
  <div id="canvasContainer" style="position:relative; display:flex; margin: auto; justify-content: flex-start; align-items: center; margin-left: 0px; cursor: crosshair;">
    <div id="s1" style="position:absolute; height: 0px; top: 0; left: 0px; width:100%; background-color: black; opacity: 1;"></div>
    <div id="s2" style="position:absolute; height: 0px; bottom: 0px; right: 0; width:100%; background-color: black; opacity: 1;"></div>
    <h1 id="countdown" style="position: absolute; display:flex; justify-content: center; align-items: center; right: 0; left: 0;">

    </h1>
  </div>
  <div style="user-select: none; display: flex; flex-direction: column; flex: 1; padding: 0px 5px; max-width: 130px; width: 130px; min-width: 130px; box-sizing: border-box;">
    <div style="width: 100%; display: flex; justify-content: center;">
      SCAN
    </div>
    <div style="display:flex">
      <button id="scanDownButton" style="width: 25%; height: 30px; font-size: 16px; padding: 0px; display:flex; justify-content: center; align-items: center; padding-top: 2px;">
        ‚¨áÔ∏è
      </button>
      <button id="scanRightButton" style="width: 25%; height: 30px; font-size: 16px; padding: 0px; display:flex; justify-content: center; align-items: center; padding-top: 2px;">
        ‚û°Ô∏è
      </button>
      <button id="scanUpButton" style="width: 25%; height: 30px; font-size: 16px; padding: 0px; display:flex; justify-content: center; align-items: center; padding-top: 2px;">
        ‚¨ÜÔ∏è
      </button>
      <button id="scanLeftButton" style="width: 25%; height: 30px; font-size: 16px; padding: 0px; display:flex; justify-content: center; align-items: center; padding-top: 2px;">
        ‚¨ÖÔ∏è
      </button>
    </div>
    <button id="scanRandomButton" style="width: 100%; height: 40px; margin-bottom: 5px; font-size: 14px; padding: 0px;">
      RANDOM üé≤
    </button>
    <button id="revealButton" style="width: 100%; height: 40px; margin-bottom: 5px; font-size: 14px; padding: 0px;">
      REVEAL üåü
    </button>
    <button id="clearButton" style="width: 100%; height: 40px; margin-bottom: 5px; font-size: 14px; padding: 0px;">
      CLEAR üóëÔ∏è
    </button>
    <button id="downloadButton" style="width: 100%; height: 40px; margin-bottom: 10px; font-size: 14px; padding: 0px;">
      DOWNLOAD
    </button>
    <a id="downloadButton2" download></a>

    <div style="display:flex; flex-direction: column; margin-bottom: 10px;
    min-height: 50px;">
      <div style="display: flex; justify-content: center;">
        TIME
      </div>

      <div style="display: flex;">
        <div id="timeSlider" style="width: 30px; height: 30px; background-color: black; display: flex; justify-content: center; align-items: center; flex-direction: column; cursor: ns-resize;">
          <div style="width: 20px; height: 1px; background-color: #aeaeae; margin: 1px;"></div>
          <div style="width: 20px; height: 1px; background-color: #aeaeae; margin: 1px;"></div>
          <div style="width: 20px; height: 1px; background-color: #aeaeae; margin: 1px;"></div>
        </div>
        <input value="50" id="timeInput" style="width: 70%; height: 30px; margin-bottom: 5px; font-size: 16px; padding: 0px; box-sizing: border-box; text-align: right; padding-right: 3px;
        margin: 0px; margin-right: 3px;
        "/>s
      </div>
    </div>

    <div style="display:flex; flex-direction: column;">
      <div style="display: flex; justify-content: center;">
        SIZE
      </div>
      <div style="display:flex;">
        <div id="sizeSlider" style="box-sizing: border-box; width: 100%; height: 200px; display: flex; flex-direction: column; justify-content: space-between; align-items: center; box-sizing: border-box; border: solid 2px black; border-top: 0px; border-bottom: 0px; cursor: ns-resize; background-color: white;">
          <div style="width: 100%; height: 15px; background-color: black; display: flex; flex-direction: column; align-items: center; justify-content: center; max-height: 15px; min-height: 15px;">
            <div style="width: 40px; height: 1px; background-color: #aeaeae; margin: 1px;"></div>
            <div style="width: 40px; height: 1px; background-color: #aeaeae; margin: 1px;"></div>
            <div style="width: 40px; height: 1px; background-color: #aeaeae; margin: 1px;"></div>
          </div>
          <div style="display:flex; justify-content: center; height: 100%;
          margin-top: 5px; margin-bottom: 5px;">
          <input value="200" id="sizeInput" style="width: 70%; height: 30px; margin-bottom: 5px; font-size: 16px; padding: 0px; box-sizing: border-box; text-align: right; padding-right: 3px;margin: 0px;"/>px
        </div>
        <div style="width: 100%; height: 15px; background-color: black; display: flex; flex-direction: column; align-items: center; justify-content: center; max-height: 15px; min-height: 15px;">
          <div style="width: 40px; height: 1px; background-color: #aeaeae; margin: 1px;"></div>
          <div style="width: 40px; height: 1px; background-color: #aeaeae; margin: 1px;"></div>
          <div style="width: 40px; height: 1px; background-color: #aeaeae; margin: 1px;"></div></div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
<footer>
  <script>

    const app = new PIXI.Application({backgroundColor: 0xffffff,width: 256, height: 256, antialias: true, sortableChildren: true});
    let container = new PIXI.Container();
    container.sortableChildren = true
    app.stage.addChild(container);
    const canvas = document.getElementById("canvasContainer")

    const stage = app.stage
    const renderer = app.renderer
    canvas.appendChild(app.view);

    let scanTime = 50
    const scanCountDown = 3000
    let scanHeight = 200
    const xOffset = 0
    const yOffset = 80
    let timeDrag = false
    let timeStartY = 0

    const s1 = document.getElementById("s1")
    const s2 = document.getElementById("s2")

    const sizeSlider = document.getElementById("sizeSlider")
    const timeInput = document.getElementById("timeInput")
    const revealButton = document.getElementById("revealButton")
    const clearButton = document.getElementById("clearButton")
    const downloadButton = document.getElementById("downloadButton")
    const downloadButton2 = document.getElementById("downloadButton2")
    const countdown = document.getElementById("countdown")
    const timeSlider = document.getElementById("timeSlider")

    downloadButton.onclick = async function (){

      const graphics = new PIXI.Graphics();
      await graphics.beginFill(0xFFFFFF);
      await graphics.drawRect(0, 0, canvas.clientWidth, canvas.clientHeight);
      graphics.zIndex = -1
      await container.addChild(graphics);

      app.renderer.extract.canvas(app.stage).toBlob(function(b){
        let a = document.createElement('a');
        document.body.append(a);
        a.download = "Scan Art Challenge";
        a.href = URL.createObjectURL(b);
        a.click();
        a.remove();
      }, 'image/png');
    }

    function clear() {
      for (let i = stage.children.length - 1; i >= 0; i--) {
        stage.removeChild(stage.children[i]);
      };
      container = new PIXI.Container();
      container.sortableChildren = true
      app.stage.addChild(container);
    }

    clearButton.onclick = clear

    revealButton.onclick = function () {
      s1.style.transition = `0.5s`
      s2.style.transition = `0.5s`
      s1.style.opacity = 0
      s2.style.opacity = 0


      clearTimeout(countdownTimeout1)
      clearTimeout(countdownTimeout2)
      clearTimeout(countdownTimeout3)
      countdown.style.transition = "none"
      countdown.innerHTML = ""
      countdown.style.opacity = 0
    }

    timeInput.addEventListener('change', function(){
      scanTime = parseInt(timeInput.value)
    })

    sizeInput.addEventListener('change', function(){
      scanHeight = parseInt(sizeInput.value)
      sizeSlider.style.height = `${scanHeight}px`
    })

    let s1Timeout = null;
    let s2Timeout = null;

    let countdownTimeout1 = null;
    let countdownTimeout2 = null;
    let countdownTimeout3 = null;

    function scan(){
      clearTimeout(s1Timeout)
      clearTimeout(s2Timeout)
      clearTimeout(countdownTimeout1)
      clearTimeout(countdownTimeout2)
      clearTimeout(countdownTimeout3)
      countdown.innerHTML = 3


      countdown.style.transition = "none"
      countdown.style.opacity = 1

      countdownTimeout1 = setTimeout(function(){
        countdown.innerHTML = 2
      }, 1000)
      countdownTimeout1 = setTimeout(function(){
        countdown.innerHTML = 1
      }, 2000)
      countdownTimeout1 = setTimeout(function(){
        countdown.innerHTML = "GO!"
        countdown.style.transition = `linear ${Math.min(scanTime/3,2)}s`
        countdown.style.opacity = 0
      }, Math.min(3000))
    }


    function scanDown(){
      s1.style.width = `${canvas.clientWidth}px`;
      s2.style.width = `${canvas.clientWidth}px`;
      s1.style.transition = "none"
      s1.style.opacity = "1"
      s2.style.transition = "none"
      s2.style.opacity = "1"
      s1.style.height = `${0}px`
      s2.style.height = `${canvas.clientHeight}px`
      scan()
      s2Timeout = setTimeout(function(){
        s2.style.transition = `all linear ${scanTime}s`
        s2.style.height = `0px`
      }, scanCountDown);
      s1Timeout = setTimeout(function(){
        s1.style.transition = `all linear ${scanTime}s`
        s1.style.height = `${canvas.clientHeight}px`
      }, scanCountDown+(scanHeight/((canvas.clientHeight)/(scanTime*1000))));
    }
    function scanRight(){
      s1.style.width = "0px";
      s2.style.width = `${canvas.clientWidth}px`;
      s1.style.transition = "none"
      s1.style.opacity = "1"
      s2.style.transition = "none"
      s2.style.opacity = "1"
      s1.style.height = `${canvas.clientHeight}px`
      s2.style.height = `${canvas.clientHeight}px`
      scan()
      s2Timeout = setTimeout(function(){
        s2.style.transition = `all linear ${scanTime}s`
        s2.style.width = "0px"
      }, scanCountDown);
      s1Timeout = setTimeout(function(){
        s1.style.transition = `all linear ${scanTime}s`
        s1.style.width = `${canvas.clientWidth}px`;
      }, scanCountDown+(scanHeight/((canvas.clientHeight)/(scanTime*1000))));
    }
    function scanUp(){
      console.log(canvas.clientWidth, canvas.clientHeight)
      s1.style.width = `${canvas.clientWidth}px`;
      s2.style.width = `${canvas.clientWidth}px`;
      s1.style.transition = "none"
      s1.style.opacity = "1"
      s2.style.transition = "none"
      s2.style.opacity = "1"
      s2.style.height = `${0}px`
      s1.style.height = `${canvas.clientHeight}px`
      scan()
      s1Timeout = setTimeout(function(){
        s1.style.transition = `all linear ${scanTime}s`
        s1.style.height = `0px`
      }, scanCountDown);
      s2Timeout = setTimeout(function(){
        s2.style.transition = `all linear ${scanTime}s`
        s2.style.height = `${canvas.clientHeight}px`
      }, scanCountDown+(scanHeight/((canvas.clientHeight)/(scanTime*1000))));
    }
    function scanLeft(){
      s2.style.width = "0px";
      s1.style.width = `${canvas.clientWidth}px`;
      s1.style.transition = "none"
      s1.style.opacity = "1"
      s2.style.transition = "none"
      s2.style.opacity = "1"
      s1.style.height = `${canvas.clientHeight}px`
      s2.style.height = `${canvas.clientHeight}px`
      scan()
      s1Timeout = setTimeout(function(){
        s1.style.transition = `all linear ${scanTime}s`
        s1.style.width = "0px"
      }, scanCountDown);
      s2Timeout = setTimeout(function(){
        s2.style.transition = `all linear ${scanTime}s`
        s2.style.width = `${canvas.clientWidth}px`;
      }, scanCountDown+(scanHeight/((canvas.clientHeight)/(scanTime*1000))));
    }

    function scanRandom(){
      const rand = Math.random()
      if (rand < .25){
        scanUp()
      } else if (rand < .5){
        scanRight()
      } else if (rand < .75){
        scanDown()
      } else{
        scanLeft()
      }
    }

    const scanDownButton = document.getElementById("scanDownButton")
    scanDownButton.onclick=scanDown

    const scanRightButton = document.getElementById("scanRightButton")
    scanRightButton.onclick=scanRight

    const scanLeftButton = document.getElementById("scanLeftButton")
    scanLeftButton.onclick=scanLeft

    const scanUpButton = document.getElementById("scanUpButton")
    scanUpButton.onclick=scanUp

    const scanRandomButton = document.getElementById("scanRandomButton")
    scanRandomButton.onclick=scanRandom


    stage.interactive = true;

    let mouseDown = false;
    let oldMouseDown = false;


    const lines = {}
    let lastX = null
    let lastY = null
    let sizeSliderStartY = 0
    let sizeSliderStartHeight = 0

    function draw(e){
      if(e.touches){
        if(document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY)?.tagName == 'DIV'){
          mouseDown = false
        } else {
          mouseDown = true
        }
      }
      if (lastX && mouseDown){
        const line = new PIXI.Graphics(); 
        line.lineStyle(1.5, 0x000000, 1); 
        if (e.touches && e.touches[0]){
          line.moveTo(lastX, lastY);
          line.lineTo(e.touches[0].clientX, e.touches[0].clientY-yOffset)
        } else {
          line.moveTo(lastX, lastY);
          line.lineTo(event.clientX, event.clientY-yOffset)
        }
        container.addChild(line);
      }


      if (e.touches && e.touches[0]){
        lastX = e.touches[0].clientX
        lastY = e.touches[0].clientY-yOffset
      } else {
        lastX = event.clientX
        lastY = event.clientY-yOffset
      }

      if(sizeSliderDrag){
        if (e.touches){
          sizeSlider.style.height = `${Math.max(70, sizeSliderStartHeight + e.touches[0].clientY - sizeSliderStartY)}px`
          const height = parseInt(sizeSlider.style.height.split("px")[0])

          sizeInput.value = height
          scanHeight = height
        } else {
          sizeSlider.style.height = `${Math.max(70, sizeSliderStartHeight + event.clientY - sizeSliderStartY)}px`
          const height = parseInt(sizeSlider.style.height.split("px")[0])

          sizeInput.value = height
          scanHeight = height
        }
      }

      if(timeDrag){
        if (e.touches){
          timeInput.value = Math.ceil(timeStartValue - (e.touches[0].clientY - timeStartY)/10)

          scanTime = Math.ceil(timeStartValue + e.touches[0].clientY - timeStartY)
        } else {
          timeInput.value = Math.ceil(timeStartValue - (event.clientY - timeStartY)/10)

          scanTime = Math.ceil(timeStartValue + event.clientY - timeStartY)

          console.log(Math.ceil((event.clientY - timeStartY)/10))

          timeSlider.style.marginTop = `${Math.min(5,Math.max(-5,Math.ceil((event.clientY - timeStartY)/10)))}px`
        }
      }
    }

    s1.addEventListener('mouseenter', e => {
      mouseDown=false;
    });

    s1.addEventListener('mouseleave', e => {
      mouseDown=oldMouseDown;
    });
    s2.addEventListener('mouseenter', e => {
      mouseDown=false;
    });

    s2.addEventListener('mouseleave', e => {
      mouseDown=oldMouseDown;
    });


    document.addEventListener("pointermove", draw);
    document.addEventListener("touchmove", draw);

    canvas.addEventListener('mousedown', 
      function(){
        oldMouseDown = true;
        mouseDown = true;
      }
      ); 
    canvas.addEventListener('mouseup', 
      function(){
        oldMouseDown = false;
        mouseDown = false;
        sizeSliderDrag = false
      }
      );
    canvas.addEventListener('touchstart', 
      function(e){
        e.preventDefault()
        oldMouseDown = true;
        mouseDown = true;
      }
      ); 
    canvas.addEventListener('touchend', 
      function(e){
        e.preventDefault();
        oldMouseDown = false;
        mouseDown = false;
      }
      );

    document.addEventListener('mouseup', 
      function(){
        oldMouseDown = false;
        mouseDown = false;
        sizeSliderDrag = false
        timeDrag = false
        timeSlider.style.transition = "ease-out 0.3s"
        timeSlider.style.marginTop = "0px"
      }
      );
    document.addEventListener('touchend', 
      function(){
        oldMouseDown = false;
        mouseDown = false;
        sizeSliderDrag = false
        timeDrag = false
        timeSlider.style.transition = "ease-out 0.3s"
        timeSlider.style.marginTop = "0px"

        lastX = null
        lastY = null
      }
      );

    function canvasResize(){
      app.renderer.resize(window.innerWidth-130, window.innerHeight-yOffset);
      s1.style.width = `${window.innerWidth-130}px`
      s2.style.width = `${window.innerWidth-130}px`
    }

    canvasResize()



    let sizeSliderDrag = false
    sizeSlider.addEventListener('mousedown', 
      function(){
        sizeSliderDrag = true
        sizeSliderStartY = event.clientY
        sizeSliderStartHeight = parseInt(sizeSlider.style.height.split("px")[0])
      }
      ); 
    sizeSlider.addEventListener('touchstart', 
      function(e){
        sizeSliderDrag = true
        sizeSliderStartY = e.touches[0].clientY
        sizeSliderStartHeight = parseInt(sizeSlider.style.height.split("px")[0])
      }
      ); 
    timeSlider.addEventListener('mousedown', 
      function(){
        timeSlider.style.transition = "none"
        timeDrag = true
        timeStartY = event.clientY
        timeStartValue = parseInt(timeInput.value)
      }
      ); 
    timeSlider.addEventListener('touchstart', 
      function(e){
        timeSlider.style.transition = "none"
        timeDrag = true
        timeStartY = e.touches[0].clientY
        timeStartValue = parseInt(timeInput.value)
      }
      ); 
    window.onresize = canvasResize

  </script>
</footer>
</html>
